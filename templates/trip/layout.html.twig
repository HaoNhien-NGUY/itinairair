{% extends 'base_with_navbar.html.twig' %}

{% block title %}{{ trip.name }}{% endblock %}
{% block body_style %}min-h-screen flex flex-col{% endblock %}

{% block additional_javascript %}
    <script>
        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
            key: "{{ get_env('GOOGLE_API_KEY') }}",
            v: "weekly",
        });
        google.maps.importLibrary("places");
    </script>
{% endblock %}

{% block body %}
    <div class="container max-w-7xl mx-auto">
        <div class="pt-8">
            <h1 id="trip-name" class="text-2xl font-medium md:text-3xl mb-1">{{ trip.name }}</h1>

            <div class="flex items-center md:text-sm gap-4 text-xs">
                <a href="{{ path('app_trip_edit', {'trip': trip.id}) }}" data-turbo-frame="modal" class="text-gray-500 md:text-sm text-xs hover:text-gray-700">{{ trip.startDate|date_xs }} {{ trip.startDate|date('Y')}} - {{ trip.endDate|date_xs }}</a>
                <twig:Trip:Countries :trip="trip" />
            </div>
            <div class="flex items-center md:text-sm text-xs justify-between md:gap-6 md:justify-start mt-4">
                <div class="flex space-x-1 select-none">
                    {% for membership in trip.tripMemberships %}
                        <div class="flex items-center">
                            <twig:UserAvatar user="{{ membership.member }}" imgClass="size-8"/>
                        </div>
                    {% endfor %}
                    <a href="{{ path('app_trip_share_link', {trip: trip.id}) }}" data-turbo-frame="modal" class="flex items-center justify-center rounded-full bg-white hover:bg-gray-200 transition-colors size-8">
                        <twig:ux:icon name="flowbite:user-add-solid" class="size-4 text-gray-600"/>
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% macro navTabBtn(title, active, path) %}
        <a href="{{ path }}"
           class="{{ active ? 'active' }} md:fond-medium max-md:flex-1 justify-center md:justify-start font-bold [&.active]:border-indigo-300 border-b-2 [&.active,&:hover]:text-indigo-400
           py-2.5 px-2 inline-flex items-center gap-x-2 border-transparent text-sm md:text-sm whitespace-nowrap text-gray-400">
            {{ title }}
        </a>
    {% endmacro %}
    <div class="sticky select-none top-0 z-30 mt-6 bg-white">
        {% set currentRoute = app.request.attributes.get('_route') %}

        <div class="border-b border-indigo-100 bg-white overflow-hidden">
            <nav class="container max-w-7xl flex gap-x-1 overflow-x-auto [&::-webkit-scrollbar]:h-0">
                {{ _self.navTabBtn('trip.page.schedule'|trans, currentRoute == 'app_trip_show', path('app_trip_show', {'id': trip.id})) }}
                {{ _self.navTabBtn('trip.page.itinerary'|trans, currentRoute == 'app_trip_itinerary', path('app_trip_itinerary', {'id': trip.id})) }}
                {{ _self.navTabBtn('trip.page.reservation'|trans, currentRoute == 'app_trip_bookings', path('app_trip_bookings', {'id': trip.id})) }}
            </nav>
        </div>
        {% block sticky_nav %}
        {% endblock %}
    </div>

    <main class="grow">
        {% block content %}
        {% endblock %}
    </main>
{% endblock %}
