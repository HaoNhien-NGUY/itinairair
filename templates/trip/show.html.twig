{% set enableMorph = true %}

{% extends 'base_with_navbar.html.twig' %}

{% block title %}{{ trip.name }}{% endblock %}

{% block additional_javascript %}
    <script>
        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
            key: "{{ get_env('GOOGLE_API_KEY') }}",
            v: "weekly",
        });
        google.maps.importLibrary("places");
    </script>
{% endblock %}

{% block body %}
	{% set startDate = trip.startDate %}
	{% set statusPlanned = enum('App\\Enum\\ItemStatus').PLANNED.value %}
	{% set statusIdea = enum('App\\Enum\\ItemStatus').IDEA.value %}

	<div>
		<div class="container max-w-7xl mx-auto">
			<div class="px-2 lg:px-4 pt-8">
				<h3 id="trip-name" class="text-4xl mb-1">{{ trip.name }}</h3>
				<div>
					<span class="text-gray-500">{{ trip.startDate|date_short }} - {{ trip.endDate|date_short }}</span>
				</div>
				<div class="flex space-x-1 mt-6">
					{% for membership in trip.tripMemberships %}
						<div class="flex items-center">
							<img src="https://placehold.co/800?text={{ membership.member.email[:1] }}&font=roboto" class="rounded-full size-8" alt="{{ membership.member.email }}">
						</div>
					{% endfor %}
					<a href="{{ path('app_trip_share_link', {trip: trip.id}) }}" data-turbo-frame="modal" class="flex items-center justify-center rounded-full bg-white hover:bg-gray-200 transition-colors size-8">
						<twig:ux:icon name="flowbite:user-add-solid" class="size-4 text-gray-600"/>
					</a>
				</div>

                {% if statistics.countries %}
                    <div class="mt-4">
                        <h3 class="text-sm font-semibold text-gray-500 mb-2 uppercase tracking-wide">Pays visit√©s</h3>
                        <div class="flex flex-wrap gap-2">
                            {% for country in statistics.countries %}
                                <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">{{ country }}</span>
                            {% endfor %}
                        </div>
                </div>
				{% endif %}
			</div>
		</div>


		<div class="flex container max-w-7xl mx-auto space-x-2 mt-10 mb-4 {% block activeTab %}planning{% endblock %}">
			<a href="{{ path('app_trip_show', {'id': trip.id}) }}" class="[.planning_&,&:hover]:bg-indigo-50 [.planning_&,&:hover]:text-indigo-400 px-5 py-1 hover:cursor-pointer text-gray-500 transition-colors rounded-2xl font-medium active">
				Planning
			</a>
			<a href="{{ path('app_trip_itinerary', {'id': trip.id}) }}" class="[.itinerary_&,&:hover]:bg-indigo-50 [.itinerary_&,&:hover]:text-indigo-400 px-5 py-1 hover:cursor-pointer text-gray-500 transition-colors rounded-2xl font-medium">
				Itineraire
			</a>
            <a href="{{ path('app_trip_bookings', {'id': trip.id}) }}" class="[.bookings_&,&:hover]:bg-indigo-50 [.bookings_&,&:hover]:text-indigo-400 px-5 py-1 hover:cursor-pointer text-gray-500 transition-colors rounded-2xl font-medium">
                Reservation
            </a>
		</div>

		<main class="border-t-3 pt-5 border-indigo-100" style="background-color: #F5F7FF">
            {% block content %}
                <div id="drag-container" class="container max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3">
                    <div class="lg:col-span-2 rounded-2xl overflow-hidden">
                        {% for day in trip.days %}
                            {{ include('trip/day.html.twig', {day: day, trip: trip, items: items[day.id] ?? null, startDate: startDate}) }}
                        {% endfor %}
                    </div>


                    <div class="max-lg:hidden">
                        <div class="space-y-4 px-4 pb-20 sticky top-4 h-screen no-scrollbar overflow-y-auto">
                            <div class="p-2 bg-white border-indigo-200 border-1z rounded-2xl card-shadow">
                                <a href="{{ path('app_trip_bookings', {'id': trip.id}) }}" class=" hover:bg-indigo-50 transition-colors rounded-xl font-medium flex items-center justify-between text-gray-500 py-2 px-3">
                                    <span class="flex items-center">Hotels et hebergements<twig:ux:icon name="bi:dash-lg" class="mx-2.5 size-5" />{{ accommodations|length }}</span>
                                    <twig:ux:icon name="iconoir:nav-arrow-right" class="size-5" />
                                </a>
                                <hr class="border border-indigo-100 my-1.5 mx-6" />
                                <a href="{{ path('app_trip_bookings', {'id': trip.id}) }}" class=" hover:bg-indigo-50 transition-colors rounded-xl font-medium flex items-center justify-between text-gray-500 py-2 px-3">
                                    <span class="flex items-center">Deplacements<twig:ux:icon name="bi:dash-lg" class="mx-2.5 size-5" />{{ accommodations|length }}</span>
                                    <twig:ux:icon name="iconoir:nav-arrow-right" class="size-5" />
                                </a>
                            </div>

                            <div class="border-1z border-indigo-200 bg-white rounded-2xl card-shadow py-4">
                                <div class="px-3 mb-3">
                                    <h3 class="font-semibold">A faire</h3>
                                    <p class="text-gray-500 text-sm">Ajouter des idees d'activite</p>
                                </div>
                                <div class="p-2">
                                    {% include 'trip/idea/_list.html.twig' %}
                                </div>

                                <div class="mt-4 px-4">
                                    <a href="{{ path('app_travelitem_create', {trip: trip.id, status: statusIdea }) }}"
                                       class="flex items-center text-gray-500 border border-indigo-200 rounded-xl px-4 py-2 hover:bg-indigo-50"
                                       data-turbo-frame="modal">
                                        <twig:ux:icon name="bx:plus" class="size-4 mr-2 text-gray-400"/>
                                        Ajouter un lieu
                                    </a>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            {% endblock %}
		</main>

	</div>
{% endblock %}
